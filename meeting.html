<!DOCTYPE html>
<html lang="km">
<head>
  <header style="background:#6a1b9a;color:#fff;padding:15px 30px;border-radius:8px;">
    <nav style="max-width:1000px;margin:auto;display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:bold;font-size:18px;">Romans Small Group 2026</div>
      <div>
        <a href="index.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ  Home</a>
        <a href="calendar.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ“… Calendar</a>
        <a href="romans.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ“– Romans Study</a>
        <a href="meeting.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ™ Meeting Notes</a>
        <a href="progress.html" style="color:#fff;text-decoration:none;margin:0 10px;">âœ… Weekly Progress</a>
      </div>
    </nav>
  </header>
  
<meta charset="UTF-8">
<title>Meeting Notes & Prayer Board</title>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCd-FGrbCelEUN370I0wmzscnLjYxxX200",
  authDomain: "bible-group-2026.firebaseapp.com",
  projectId: "bible-group-2026",
  storageBucket: "bible-group-2026.appspot.com",
  messagingSenderId: "639986298395",
  appId: "1:639986298395:web:d9d92344e516c4f5e112be"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// expose globally
window.db = db;
window.doc = doc;
window.setDoc = setDoc;
window.onSnapshot = onSnapshot;
</script>

<style>
body{font-family:Arial;background:#f5f5f5}
textarea{width:100%;min-height:400px;padding:10px}
button{padding:6px 12px;margin-right:5px}
</style>
</head>

<body>

<h2>ğŸ™ğŸ“ Meeting Notes & Prayer Board</h2>

<!-- Date & Leader -->
<div>
  <label><b>Date:</b></label>
  <input type="date" id="meetingDate">

  <label style="margin-left:10px;"><b>Leader:</b></label>
  <select id="meetingLeader">
    <option value="">Select leader</option>
    <option>Khoem Toeurn</option>
    <option>Vichhai Samrith</option>
    <option>Bonthoeurn Daniel</option>
    <option>David Pean</option>
    <option>Doeun Lai</option>
  </select>
</div>

<hr>

<!-- Tabs -->
<button onclick="showTab('prayer')">ğŸ™ Prayer</button>
<button onclick="showTab('notes')">ğŸ“ Notes</button>

<!-- Prayer -->
<div id="prayerTab">
  <textarea id="prayerNote" placeholder="Prayer requests..."></textarea>
</div>

<!-- Notes -->
<div id="notesTab" style="display:none">
  <textarea id="meetingNote" placeholder="Meeting notes..."></textarea>
</div>

<script>
let activeDate = null;
let unsubscribe = null;

// Tabs
function showTab(tab){
  prayerTab.style.display = tab==="prayer" ? "block" : "none";
  notesTab.style.display  = tab==="notes"  ? "block" : "none";
}

// Load data by date
function loadMeeting(date){
  if(unsubscribe) unsubscribe();

  const ref = doc(db,"meetings",date);

  unsubscribe = onSnapshot(ref,(snap)=>{
    if(snap.exists()){
      const d = snap.data();
      meetingLeader.value = d.leader || "";
      prayerNote.value = d.prayer || "";
      meetingNote.value = d.notes || "";
    }else{
      meetingLeader.value = "";
      prayerNote.value = "";
      meetingNote.value = "";
    }
  });
}

// Save (ONLY to selected date)
async function saveMeeting(){
  if(!activeDate) return;

  await setDoc(
    doc(db,"meetings",activeDate),
    {
      date: activeDate,
      leader: meetingLeader.value,
      prayer: prayerNote.value,
      notes: meetingNote.value,
      updatedAt: new Date()
    },
    { merge:true }
  );
}

// Events
meetingDate.addEventListener("change", ()=>{
  activeDate = meetingDate.value;
  loadMeeting(activeDate);
});

meetingLeader.addEventListener("change", saveMeeting);
prayerNote.addEventListener("input", saveMeeting);
meetingNote.addEventListener("input", saveMeeting);
</script>

</body>
</html>
