<!DOCTYPE html>
<html lang="km">
<head>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyCd-FGrbCelEUN370I0wmzscnLjYxxX200",
  authDomain: "bible-group-2026.firebaseapp.com",
  projectId: "bible-group-2026",
  storageBucket: "bible-group-2026.firebasestorage.app",
  messagingSenderId: "639986298395",
  appId: "1:639986298395:web:d9d92344e516c4f5e112be"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Make global
window.db = db;
window.doc = doc;
window.setDoc = setDoc;
window.getDoc = getDoc;
window.onSnapshot = onSnapshot;
</script>

    
<meta charset="UTF-8">
<title>Meeting Notes & Prayer Board</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<?php include 'header.html'; ?>
<header style="background:#6a1b9a;color:#fff;padding:15px 30px;border-radius:8px;">
    <nav style="max-width:1000px;margin:auto;display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:bold;font-size:18px;">The 5 brothers |Small Group 2026|</div>
      <div>
        <a href="index.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ  Home</a>
        <a href="calendar.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ“… Calendar</a>
        <a href="romans.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ“– Bible</a>
        <a href="meeting.html" style="color:#fff;text-decoration:none;margin:0 10px;">ğŸ™ Meeting Notes</a>
        <a href="progress.html" style="color:#fff;text-decoration:none;margin:0 10px;">âœ… Weekly Progress</a>
      </div>
    </nav>
  </header>
  

<section style="max-width:900px;margin:40px auto;">
<h2>ğŸ™ğŸ“ Meeting Notes & Prayer Board</h2>

<!-- Date & Leader -->
<div style="margin-bottom:15px;">
  <label><strong>Date:</strong></label>
  <input type="date" id="meetingDate" onchange="saveMeta()">
  <label style="margin-left:15px;"><strong>Leader:</strong></label>
  <select id="meetingLeader" onchange="saveMeta()">
    <option value="">Select leader</option>
    <option value="Khoem Toeurn">Khoem Toeurn</option>
    <option value="Bonthoeurn Daniel">Bonthoeurn Daniel</option>
    <option value="David Pean">David Pean</option>
    <option value="Vichhai Samrith">Vichhai Samrith</option>
    <option value="Doeun Lai">Doeun Lai</option>
  </select>
</div>

<!-- Tabs -->
<div style="margin-bottom:10px;">
  <button onclick="showTab('prayer')">ğŸ™ Prayer Requests</button>
  <button onclick="showTab('notes')">ğŸ“ Meeting Notes</button>
  <button onclick="printMeeting()">ğŸ–¨ï¸ Print / PDF</button>
</div>

<div id="prayerTab">
<textarea id="prayerNote" placeholder="â€¢ Prayer request\nâ€¢ Family\nâ€¢ Health\nâ€¢ Ministry..." style="width:100%; min-height:1000px; padding:2px;" oninput="savePrayer()"></textarea>
<button onclick="clearPrayer()" style="margin-top:8px;">ğŸ—‘ï¸ Clear Prayer</button>
</div>

<div id="notesTab" style="display:none;">
<textarea id="meetingNote" placeholder="â€¢ Key sharing point\nâ€¢ Teaching highlight\nâ€¢ Action steps..." style="width:100%; min-height:1000px; padding:2px;" oninput="saveMeetingNote()"></textarea>
<button onclick="clearMeetingNote()" style="margin-top:8px;">ğŸ—‘ï¸ Clear Notes</button>
</div>

</section>

<script>
function saveMeta(){
  localStorage.setItem("meetingDate", meetingDate.value);
  localStorage.setItem("meetingLeader", meetingLeader.value);
}
function savePrayer(){localStorage.setItem("prayerNote", prayerNote.value);}
function saveMeetingNote(){localStorage.setItem("meetingNote", meetingNote.value);}
function loadAll(){
  meetingDate.value = localStorage.getItem("meetingDate") || "";
  meetingLeader.value = localStorage.getItem("meetingLeader") || "";
  prayerNote.value = localStorage.getItem("prayerNote") || "";
  meetingNote.value = localStorage.getItem("meetingNote") || "";
}
function clearPrayer(){if(!confirm("Clear prayer requests?")) return; prayerNote.value=""; localStorage.removeItem("prayerNote");}
function clearMeetingNote(){if(!confirm("Clear meeting notes?")) return; meetingNote.value=""; localStorage.removeItem("meetingNote");}
function showTab(tab){
  prayerTab.style.display = tab==="prayer"?"block":"none";
  notesTab.style.display = tab==="notes"?"block":"none";
}
function printMeeting(){
  const content = `<h2>Small Group Meeting Notes</h2><p><strong>Date:</strong> ${meetingDate.value}</p><p><strong>Leader:</strong> ${meetingLeader.value}</p><hr><h3>ğŸ™ Prayer Requests</h3><p>${prayerNote.value.replace(/\n/g,"<br>")}</p><hr><h3>ğŸ“ Meeting Notes</h3><p>${meetingNote.value.replace(/\n/g,"<br>")}</p>`;
  const win = window.open("","", "width=900,height=700");
  win.document.write(`<html><head><title>Meeting Notes</title><style>body{font-family:Arial;padding:20px;}</style></head><body>${content}</body></html>`);
  win.document.close(); win.print();
}
window.onload = loadAll;
</script>

<script>
let currentDoc = null;

function getDocId(){
  return meetingDate.value || "latest";
}

async function saveAll(){
  if(!meetingDate.value) return;

  currentDoc = getDocId();

  await setDoc(doc(db, "meetings", currentDoc), {
    date: meetingDate.value,
    leader: meetingLeader.value,
    prayer: prayerNote.value,
    notes: meetingNote.value,
    updatedAt: new Date()
  });
}

function listenData(){
  if(!meetingDate.value) return;

  currentDoc = getDocId();

  onSnapshot(doc(db, "meetings", currentDoc), (snap)=>{
    if(snap.exists()){
      const d = snap.data();
      meetingLeader.value = d.leader || "";
      prayerNote.value = d.prayer || "";
      meetingNote.value = d.notes || "";
    }
  });
}

meetingDate.addEventListener("change", ()=>{
  saveAll();
  listenData();
});
meetingLeader.addEventListener("change", saveAll);
prayerNote.addEventListener("input", saveAll);
meetingNote.addEventListener("input", saveAll);

function clearPrayer(){
  if(!confirm("Clear prayer requests?")) return;
  prayerNote.value="";
  saveAll();
}
function clearMeetingNote(){
  if(!confirm("Clear meeting notes?")) return;
  meetingNote.value="";
  saveAll();
}

function showTab(tab){
  prayerTab.style.display = tab==="prayer"?"block":"none";
  notesTab.style.display = tab==="notes"?"block":"none";
}

function printMeeting(){
  const content = `
  <h2>Small Group Meeting Notes</h2>
  <p><strong>Date:</strong> ${meetingDate.value}</p>
  <p><strong>Leader:</strong> ${meetingLeader.value}</p>
  <hr>
  <h3>ğŸ™ Prayer Requests</h3>
  <p>${prayerNote.value.replace(/\n/g,"<br>")}</p>
  <hr>
  <h3>ğŸ“ Meeting Notes</h3>
  <p>${meetingNote.value.replace(/\n/g,"<br>")}</p>
  `;
  const win = window.open("","", "width=900,height=700");
  win.document.write(`<html><head><title>Meeting Notes</title></head><body>${content}</body></html>`);
  win.print();
}

  const date = new URLSearchParams(window.location.search).get("date");
loadPrayerByDate(date);

</script>




</body>
</html>
